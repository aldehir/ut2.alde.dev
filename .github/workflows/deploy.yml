name: Deploy
on:
  workflow_dispatch:
  push:
    branches: [main]

jobs:
  deploy-to-staging:
    name: Deploy to Staging
    uses: ./.github/workflows/provision.yml
    with:
      environment: staging
      stack: dev
    secrets: inherit

  deploy-to-production:
    name: Deploy to Production
    needs: deploy-to-staging
    uses: ./.github/workflows/provision.yml
    with:
      environment: production
      stack: production
    secrets: inherit
